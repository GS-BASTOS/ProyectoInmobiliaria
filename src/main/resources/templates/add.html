<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head('Agregar')}"></head>
<body>
<nav th:replace="~{fragments :: nav}"></nav>

<div class="container">
  <div class="card">
    <h2>Agregar cliente + interés</h2>

    <form th:action="@{/agregar}" th:object="${form}" method="post">

      <!-- ERRORES GLOBALES: dentro del form para que #fields funcione -->
      <div class="global-errors" th:if="${#fields.hasGlobalErrors()}">
        <div th:each="e : ${#fields.globalErrors()}" th:text="${e}">Error</div>

        <div th:if="${existingClientId != null}" style="margin-top:8px;">
          <a th:href="@{|/clientes/${existingClientId}|}">Abrir ficha del cliente existente</a>
        </div>
      </div>

      <div class="grid-3">
        <div>
          <label>Tipo de cliente</label>
          <select th:field="*{clientType}">
            <option th:each="t : ${clientTypes}" th:value="${t}" th:text="${t}"></option>
          </select>
          <div class="field-error" th:if="${#fields.hasErrors('clientType')}" th:errors="*{clientType}"></div>
        </div>

        <div>
          <label>Fecha contacto</label>
          <input type="date" th:field="*{contactDate}">
          <div class="field-error" th:if="${#fields.hasErrors('contactDate')}" th:errors="*{contactDate}"></div>
        </div>

        <div>
          <label>Canal</label>
          <select th:field="*{channel}">
            <option th:each="c : ${channels}" th:value="${c}" th:text="${c}"></option>
          </select>
          <div class="field-error" th:if="${#fields.hasErrors('channel')}" th:errors="*{channel}"></div>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Nombre completo</label>
          <input th:field="*{fullName}">
          <div class="field-error" th:if="${#fields.hasErrors('fullName')}" th:errors="*{fullName}"></div>
        </div>

        <div>
          <label>Código Solvia</label>
          <input th:field="*{solviaCode}">
          <div class="field-error" th:if="${#fields.hasErrors('solviaCode')}" th:errors="*{solviaCode}"></div>
        </div>
      </div>

      <div class="grid-3">
        <div>
          <label>Teléfono 1 (principal)</label>
          <input th:field="*{phone1}">
          <div class="field-error" th:if="${#fields.hasErrors('phone1')}" th:errors="*{phone1}"></div>
        </div>

        <div>
          <label>Teléfono 2</label>
          <input th:field="*{phone2}">
          <div class="field-error" th:if="${#fields.hasErrors('phone2')}" th:errors="*{phone2}"></div>
        </div>

        <div>
          <label>Teléfono 3</label>
          <input th:field="*{phone3}">
          <div class="field-error" th:if="${#fields.hasErrors('phone3')}" th:errors="*{phone3}"></div>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Email 1</label>
          <input th:field="*{email1}">
          <div class="field-error" th:if="${#fields.hasErrors('email1')}" th:errors="*{email1}"></div>
        </div>

        <div>
          <label>Email 2</label>
          <input th:field="*{email2}">
          <div class="field-error" th:if="${#fields.hasErrors('email2')}" th:errors="*{email2}"></div>
        </div>
      </div>

      <div class="grid">
        <div>
          <label>Estado (color)</label>
          <select th:field="*{status}">
            <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}"></option>
          </select>
          <div class="field-error" th:if="${#fields.hasErrors('status')}" th:errors="*{status}"></div>

          <div class="small" style="margin-top:8px">
            <span class="badge"><span class="dot azul"></span>Azul</span>
            <span class="badge"><span class="dot naranja"></span>Naranja</span>
            <span class="badge"><span class="dot rosa"></span>Rosa</span>
            <span class="badge"><span class="dot verde"></span>Verde</span>
            <span class="badge"><span class="dot amarillo"></span>Amarillo</span>
          </div>
        </div>

        <div>
          <label>Municipio/Población</label>
          <input th:field="*{municipality}">
          <div class="field-error" th:if="${#fields.hasErrors('municipality')}" th:errors="*{municipality}"></div>
        </div>
      </div>

      <div class="grid-3">
        <div>
          <label>Código inmueble</label>
          <input th:field="*{propertyCode}">
          <div class="field-error" th:if="${#fields.hasErrors('propertyCode')}" th:errors="*{propertyCode}"></div>
        </div>

        <div>
          <label>Tipo de inmueble</label>
          <input th:field="*{propertyType}">
          <div class="field-error" th:if="${#fields.hasErrors('propertyType')}" th:errors="*{propertyType}"></div>
        </div>

        <div>
          <label>Dirección inmueble</label>
          <input th:field="*{address}">
          <div class="field-error" th:if="${#fields.hasErrors('address')}" th:errors="*{address}"></div>
        </div>
      </div>

      <div>
        <label>Comentarios</label>
        <textarea th:field="*{comments}"></textarea>
        <div class="field-error" th:if="${#fields.hasErrors('comments')}" th:errors="*{comments}"></div>
      </div>

      <div class="actions">
        <button type="submit">Guardar</button>
        <a class="small" th:href="@{/interesados}">Cancelar</a>
      </div>
    </form>
  </div>
</div>
</body>
</html>
